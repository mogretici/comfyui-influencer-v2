# AI Influencer Pipeline — 23 Subat 2026 Ilerleme Raporu

## Ozet

Docker image basariyla build edildi, Docker Hub'a push edildi, kod GitHub'a yuklendi.
Siradaki adim: RunPod Serverless endpoint olusturma ve ilk test.

---

## Tamamlanan Isler

### 1. Docker Image Build (BASARILI)

- **Image:** `mogretici/comfyui-influencer-v2:latest`
- **Boyut:** 45.1 GB
- **Build suresi:** ~65 dakika (23 step)
- **Base:** `nvidia/cuda:12.6.3-cudnn-runtime-ubuntu24.04`

Icerdigi teknolojiler:
- ComfyUI (comfy-cli ile kurulu, CUDA 12.6)
- Flux 2 Dev GGUF Q5 (~23GB) — ana model
- T5-XXL FP8 + CLIP-L (~5.5GB) — text encoder
- VAE (~0.5GB) — `ffxvs/vae-flux` public mirror
- XLabs IP-Adapter v2 (~1GB) — yuz rehberligi
- InsightFace AntelopeV2 (~300MB) — yuz tespiti
- YOLOv8m + MobileSAM (~75MB) — FaceDetailer icin
- 4x-UltraSharp (~65MB) — upscaler
- ControlNet OpenPose (~2.8GB) — poz kontrolu (raulc0399, XLabs uyumlu)
- Flux Realism LoRA (~300MB) — fotorealizm

### 2. Docker Hub Push (BASARILI)

- **Registry:** `docker.io/mogretici/comfyui-influencer-v2:latest`
- **Push suresi:** ~66 dakika
- **Durum:** Basariyla yuklendi

### 3. GitHub Repo (BASARILI)

- **Repo:** `mogretici/comfyui-influencer-v2` (PRIVATE)
- **Branch:** `main`
- **Commitler:**
  1. `fix: use public VAE mirror + XLabs-compatible OpenPose model` — Dockerfile URL duzeltmeleri
  2. `feat: add AI Influencer Studio panel (Next.js + i18n)` — Studio paneli (73 dosya, 24K+ satir)

### 4. Cozulen Sorunlar

| Sorun | Cozum |
|-------|-------|
| VAE 401 (gated repo) | `ffxvs/vae-flux` public mirror kullanildi |
| OpenPose 404 (XLabs'ta yok) | `raulc0399/flux_dev_openpose_controlnet` kullanildi (XLabs pipeline icin egitilmis) |
| Colima VM disk %100 dolu | `docker system prune -af` ile 79.7GB temizlendi |
| Buildx log 2MiB limiti | Disk kullanimi ve process durumu ile takip edildi |

### 5. HuggingFace URL Dogrulamasi

Tum 10 model URL'si test edildi — hepsi 200 OK:

```
1. Flux 2 Dev GGUF Q5     — city96/FLUX.2-dev-gguf ✓
2. T5-XXL FP8             — comfyanonymous/flux_text_encoders ✓
3. CLIP-L                 — comfyanonymous/flux_text_encoders ✓
4. VAE                    — ffxvs/vae-flux ✓
5. IP-Adapter v2          — XLabs-AI/flux-ip-adapter-v2 ✓
6. InsightFace AntelopeV2 — MonsterMMORPG/tools ✓
7. YOLOv8m Face           — Tenofas/ComfyUI ✓
8. MobileSAM              — ChaoningZhang/MobileSAM ✓
9. 4x-UltraSharp          — lokCX/4x-Ultrasharp ✓
10. OpenPose ControlNet   — raulc0399/flux_dev_openpose_controlnet ✓
```

---

## Kalan Isler (Siradaki Adimlar)

### Adim 1: RunPod Serverless Endpoint (ACIL)

RunPod'da yeni endpoint olustur:

```
GPU:              A40 48GB
Image:            mogretici/comfyui-influencer-v2:latest
Min Workers:      0
Max Workers:      3
Idle Timeout:     60s
Execution Timeout: 300s
Container Disk:   50GB
```

**Maliyet tahmini (A40 — $0.00034/sn):**
- Her gorsel (warm): ~60s = ~$0.020
- Her gorsel (cold): ~90s = ~$0.031
- 100 gorsel/gun: ~$2/gun
- Aylik (3K gorsel): ~$60

### Adim 2: API Testi

Endpoint aktif oldugunda, workflow JSON ile ilk gorsel uret:

```bash
python scripts/test-workflow.py --endpoint <RUNPOD_ENDPOINT_URL> --workflow workflows/txt2img-face-lora.json
```

Test edilecek workflow'lar:
1. `txt2img-face-lora.json` — Text-to-image + Face LoRA + IP-Adapter
2. `img2img-edit.json` — Sahne/kiyafet degistirme
3. `face-detailer-upscale.json` — Yuz detay + 4K upscale

### Adim 3: Custom Face LoRA Egitimi

SimpleTuner ile Flux 2 Dev uzerine kendi yuz LoRA'ni egit:
- 10-20 referans foto (farkli aci, isik, ifade)
- Cikti: `my_face.safetensors`
- Hedef: %97 kimlik tanima orani

### Adim 4: Studio ↔ RunPod Entegrasyonu

Studio panelindeki `api.ts` dosyasini RunPod endpoint URL'sine bagla:
- Generate sayfasi → txt2img workflow
- Editor sayfasi → img2img workflow
- Batch sayfasi → toplu uretim

### Adim 5: Uretim Testi

- 10 farkli prompt ile gorsel uret
- Yuz tutarliligi kontrol et
- AI tespit oranini test et
- Kalite ve hiz optimize et

---

## Teknik Notlar

### Neden A40 (L40S degil)?

| GPU | VRAM | $/sn | Foto basi (warm) |
|-----|------|------|-------------------|
| **A40** | 48GB | $0.00034 | **$0.020** |
| L40S | 48GB | $0.00053 | $0.032 |

A40 ayni VRAM'e sahip, %37 daha ucuz. Compute performansi yeterli.

### Neden raulc0399 OpenPose?

XLabs'in resmi `flux-controlnet-collections` reposunda sadece canny, depth, hed var — openpose YOK.
`raulc0399/flux_dev_openpose_controlnet` modeli XLabs pipeline icin ozel olarak egitilmis (2.8GB).

### VRAM Butcesi (48GB)

```
Flux 2 Dev Q5:     ~23 GB
T5-XXL FP8:        ~5 GB
CLIP-L:            ~0.5 GB
VAE:               ~0.5 GB
IP-Adapter v2:     ~1 GB
InsightFace:       ~0.5 GB
────────────────────────────
Toplam:            ~31 GB
Kalan:             ~17 GB (FaceDetailer, LoRA, buffer)
```

---

## Dosya Yapisi

```
comfyui-influencer-v2/
├── Dockerfile                          # Docker image (45.1GB, 23 step)
├── docker-compose.yml                  # Lokal test
├── .dockerignore
├── .gitignore
├── .github/workflows/build-push.yml    # GitHub Actions (opsiyonel)
├── src/
│   ├── handler.py                      # RunPod serverless handler
│   ├── start.sh                        # Container baslangic scripti
│   └── extra_model_paths.yaml          # ComfyUI model yollari
├── scripts/
│   ├── download-models.sh              # Model indirme helper
│   └── test-workflow.py                # API test scripti
├── workflows/
│   ├── txt2img-face-lora.json          # Text-to-image + Face LoRA
│   ├── img2img-edit.json               # Sahne/kiyafet degistirme
│   └── face-detailer-upscale.json      # Yuz detay + 4K upscale
├── studio/                             # Next.js admin paneli (TR+EN i18n)
│   ├── src/app/                        # Sayfalar (generate, editor, gallery...)
│   ├── src/components/                 # UI componentleri
│   ├── src/lib/                        # Config, store, i18n
│   └── src/messages/                   # tr.json, en.json
└── README.md
```

---

## Evde Devam Icin Checklist

- [ ] RunPod hesabina gir
- [ ] A40 48GB ile yeni Serverless Endpoint olustur
- [ ] Image: `mogretici/comfyui-influencer-v2:latest`
- [ ] Endpoint URL'sini al
- [ ] `python scripts/test-workflow.py` ile test et
- [ ] Ilk gorsel basariyla uretildiyse → LoRA egitimi baslat
- [ ] Studio'yu RunPod'a bagla
