services:
  comfyui:
    build: .
    image: comfyui-influencer-v2:latest
    ports:
      - "8188:8188"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    volumes:
      # Mount custom LoRA files from host
      - ./models/loras:/comfyui/models/loras/custom:ro
      # Mount workflow files for easy iteration
      - ./workflows:/workflows:ro
      # Persist output images
      - ./output:/comfyui/output
    environment:
      - COMFYUI_PORT=8188
      - NVIDIA_VISIBLE_DEVICES=all
    restart: unless-stopped
